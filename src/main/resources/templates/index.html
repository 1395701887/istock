<#compress>
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>股票筛选</title>
    <script src="https://cdn.bootcss.com/jquery/2.2.4/jquery.min.js"></script>
    <script src="/plugs/jqgrid/jquery.jqGrid.min.js"></script>
    <script src="/plugs/jqgrid/grid.locale-cn.js"></script>
    <link rel="stylesheet" href="/bootstrap/css/bootstrap.min.css"  crossorigin="anonymous">
    <link rel="stylesheet" type="text/css" media="screen"  href="/plugs/jqgrid/ui.jqgrid-bootstrap.css"/>
    <script src="/bootstrap/js/bootstrap.min.js"  ></script>
    <!--<script src="https://cdn.bootcss.com/vue/2.5.16/vue.min.js"></script>-->
    <!--
    <link href="//cdn.bootcss.com/limonte-sweetalert2/6.6.5/sweetalert2.min.css" rel="stylesheet">
    <script src="//cdn.bootcss.com/limonte-sweetalert2/6.6.5/sweetalert2.min.js"></script>
    <link href="https://cdn.bootcss.com/animate.css/3.5.2/animate.min.css" rel="stylesheet">
    <script src="https://cdn.bootcss.com/mouse0270-bootstrap-notify/3.1.7/bootstrap-notify.min.js"></script>
    <script src="/js/util.js"></script>
    <script src="/js/messageBox.js"></script>-->
    <style>
        div.header
        　　 {
            　　text-align: center;
        }
        #app span{margin-left: 10px; }
    </style>
</head>
<body style="padding: 20px 0px 0px 10px;overflow: hidden;">
<div class="row" style="margin-bottom: 10px;">
    <div class="col-md-5" style="padding-left: 30px;">
        <form class="form-inline" onkeydown="if(event.keyCode==13){reloadStock(); return false;}">
            <div class="form-group">
                <div class="input-group">
                    <div class="input-group-addon">$</div>
                    <input type="text" class="form-control" id="stockCode" placeholder="代码 / 股票名称" maxlength="6" >
                </div>
            </div>
            <div class="form-group">
                <div class="input-group">
                    <select class="form-control" id="stockType" placeholder="市场">
                        <option value="">全部</option>
                        <option value="sz">深市</option>
                        <option value="sh">沪市</option>
                    </select>
                </div>
            </div>
            <button type="button" class="btn btn-primary" id="search_btn">查询</button>
            <button type="button" class="btn btn-info" id="refresh_btn">刷新</button>

            <!-- Single button -->
            <div class="btn-group">
                <button type="button" class="btn btn-warning dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                    历史数据 <span class="caret"></span>
                </button>
                <ul class="dropdown-menu">
                    <li><a href="#"  id="dy_btn">历史分红</a></li>
                    <li><a href="#" id="roe_btn">历史净资产收益率</a></li>
                    <li role="separator" class="divider"></li>
                    <li><a href="#" id="pe_btn">历史市盈率</a></li>
                    <li><a href="#" id="pb_btn">历史市净率</a></li>
                </ul>
            </div>
        </form>
    </div>

    <div class="col-md-7">
        <!---->
        <!--<div id="app">
            <div v-if="show">
                <span  v-bind:style="{ color: sz_color}">{{ sz[0] }} <span v-bind:class="[sz_icon]"></span> {{ sz[3] }} {{ sz_range}}</span>
                <span  v-bind:style="{ color: sh_color}">{{ sh[0] }} <span v-bind:class="[sh_icon]"></span> {{ sh[3] }} {{ sh_range}}</span>
                <span  v-bind:style="{ color: cyb_color}">{{ cyb[0] }} <span v-bind:class="[cyb_icon]"></span> {{ cyb[3] }} {{ cyb_range}}</span>
                <span  v-bind:style="{ color: hs300_color}">{{ hs300[0] }} <span v-bind:class="[hs300_icon]"></span>{{ hs300[3] }} {{ hs300_range}}</span>
            </div>
        </div>-->
        <!---->
    </div>
</div>

<table id="jqGrid"></table>
<div id="jqGridPager"></div>

</body>
</html>
<script id="stockspt" src="http://hq.sinajs.cn/list=sz399001,sh000001,sz399006,sh000300"></script>
<script type="text/javascript">
    $(document).ready(function () {
        $("#jqGrid").jqGrid({
            url:  "/stock/q",
            width: window.screen.availWidth - 20,
            autowidth: false,
            shrinkToFit: false,
            multiselect: false,//复选框
            rownumbers: true,
            loadtext: '正在加载数据请稍后...',
            mtype: "GET",
            styleUI: 'Bootstrap',
            datatype: "json",
            colNames: ['代码', '名称','市场', '当前价格', '昨收','今日最高','今日最低', '涨幅', 'PE(动态)', 'PE(静态)', '市净率', '总市值', '净资产收益率', '每股净资产','最新股息','上次分红率','上次分红日期', '所属行业'],
            colModel: [

                {label: 'code', name: 'code', width: 100},
                {label: 'name', name: 'name', width: 150},
                {label: 'type', name: 'type', width: 50},
                {label: 'price', name: 'price', width: 70, align: 'right'},
                {label: 'yesterdayPrice', name: 'yesterdayPrice', width: 60, align: 'right'},

                {label: 'todayMax', name: 'todayMax', width: 70, align: 'right'},
                {label: 'todayMin', name: 'todayMin', width: 70, align: 'right'},

                {label: 'fluctuate', name: 'fluctuate', width: 70, align: 'right'},
                {label: 'ped', name: 'ped', width: 75, align: 'right'},
                {label: 'pes', name: 'pes', width: 75, align: 'right'},
                {label: 'pb', name: 'pb', width: 70, align: 'right'},

                {label: 'totalValue', name: 'totalValue', width: 80, align: 'right'},
                {label: 'roe', name: 'roe', width: 100, align: 'right'},
                {label: 'bvps', name: 'bvps', width: 90, align: 'right'},
                {label: 'dy', name: 'dy', width: 86, align: 'right'},
                {label: 'dividend', name: 'dividend', width: 86, align: 'right'},
                {label: 'dividendDate', name: 'dividendDate', width: 98},
                {label: 'industry', name: 'industry', width: 200}
//                {label: 'sVersion', name: 'sVersion', width: 650}
            ],
            viewrecords: true,
            rowList: [10, 20, 30, 60],
            //height: '90%',
            rowNum: 20,
            pager: "#jqGridPager",
            gridComplete: function () {
                var ids = $("#jqGrid").getDataIDs();
                for (var i = 0; i < ids.length; i++) {
                    var rowData = $("#jqGrid").getRowData(ids[i]);
                    if (parseFloat(rowData.fluctuate) <= 0) {
                        $("#jqGrid").find('#' + ids[i]).find("td").css("color", "green");
                    }else{
                        $("#jqGrid").find('#' + ids[i]).find("td").css("color", "red");
                    }
                }
            },
            ondblClickRow: function(id){
                //双击行
               /* var rowData = $("#jqGrid").getRowData(id);
                window.open("/stock/his_dy/"+rowData.code);*/
            }
        });
        //$("#jqGrid").jqGrid("setFrozenColumns");
        doResize();
    });
    var t=document.documentElement.clientWidth;
    window.onresize = function(){
        if(t != document.documentElement.clientWidth){
            t = document.documentElement.clientWidth;
            doResize();
        }
    }

    function getPageSize() {
        var winW, winH;
        if(window.innerHeight) {// all except IE
            winW = window.innerWidth;
            winH = window.innerHeight;
        } else if (document.documentElement && document.documentElement.clientHeight) {// IE 6 Strict Mode
            winW = document.documentElement.clientWidth;
            winH = document.documentElement.clientHeight;
        } else if (document.body) { // other
            winW = document.body.clientWidth;
            winH = document.body.clientHeight;
        }  // for small pages with total size less then the viewport
        return {WinW:winW, WinH:winH};
    }

    function doResize() {
        var ss = getPageSize();
        $("#jqGrid").jqGrid('setGridWidth', ss.WinW-10).jqGrid('setGridHeight', ss.WinH-200);
    }



    //刷新列表
    function reloadStock(){
        //此处可以添加对查询数据的合法验证
        var code = $("#stockCode").val();
        var type = $("#stockType").val();
        $("#jqGrid").jqGrid('setGridParam',{
            datatype:'json',
            postData:{'code':code,'type':type},
            page:1
        }).trigger("reloadGrid");
    }

    $("#search_btn").click(function(){
        reloadStock();
    });
    $("#refresh_btn").click(function(){
        $("#stockCode").val("");
        reloadStock();
    });
    $("#dy_btn").click(function(){
        var ids = $("#jqGrid").jqGrid('getGridParam','selrow');
        if(null==ids){
            alert("请选择要查看的股票!");
            return ;
        }
        var rowData = $("#jqGrid").jqGrid('getRowData',ids);
        window.open("/stock/his_dy/"+rowData.code);
    });
    $("#roe_btn").click(function(){
        var ids = $("#jqGrid").jqGrid('getGridParam','selrow');
        if(null==ids){
            alert("请选择要查看的股票!");
            return ;
        }
        var rowData = $("#jqGrid").jqGrid('getRowData',ids);
        window.open("/stock/his_roe/"+rowData.code);
    });
    $("#pe_btn").click(function(){
        var ids = $("#jqGrid").jqGrid('getGridParam','selrow');
        if(null==ids){
            alert("请选择要查看的股票!");
            return ;
        }
        var rowData = $("#jqGrid").jqGrid('getRowData',ids);
        window.open("/stock/his_pe/"+rowData.code);
    });
    $("#pb_btn").click(function(){
        var ids = $("#jqGrid").jqGrid('getGridParam','selrow');
        if(null==ids){
            alert("请选择要查看的股票!");
            return ;
        }
        var rowData = $("#jqGrid").jqGrid('getRowData',ids);
        window.open("/stock/his_pb/"+rowData.code);
    });


    /*var app = new Vue({
        el: '#app',
        data: {
            show:false,
            sz:hq_str_sz399001.split(","),
            sz_color:"",
            sz_icon:"",
            sz_range:"",
            sh:hq_str_sh000001.split(","),
            sh_color:"",
            sh_icon:"",
            sh_range:"",
            cyb:hq_str_sz399006.split(","),
            cyb_color:"",
            cyb_icon:"",
            cyb_range:"",
            hs300:hq_str_sh000300.split(","),
            hs300_color:"",
            hs300_icon:"",
            hs300_range:""
        },
        created: function () {
            this.initdata();
        },methods:{
            initdata:function () {
                //console.info(this.sz[3]);
                this.sz=hq_str_sz399001.split(",");
                this.sh=hq_str_sh000001.split(",");
                this.cyb=hq_str_sz399006.split(",");
                this.hs300=hq_str_sh000300.split(",");
                this.sz_color= this.stockColor(this.sz[3],this.sz[2]);
                this.sz_icon=this.stockIcon(this.sz[3],this.sz[2]);
                this.sz_range=this.stockRange(this.sz[3],this.sz[2]);

                this.sh_color= this.stockColor(this.sh[3],this.sh[2]);
                this.sh_icon=this.stockIcon(this.sh[3],this.sh[2]);
                this.sh_range=this.stockRange(this.sh[3],this.sh[2]);

                this.cyb_color= this.stockColor(this.cyb[3],this.cyb[2]);
                this.cyb_icon=this.stockIcon(this.cyb[3],this.cyb[2]);
                this.cyb_range=this.stockRange(this.cyb[3],this.cyb[2]);

                this.hs300_color= this.hs300[3]>this.hs300[2]?"red":"green";
                this.hs300_icon=this.stockIcon(this.hs300[3],this.hs300[2]);
                this.hs300_range=this.stockRange(this.hs300[3],this.hs300[2]);
                this.show=true;
            },
            stockColor:function(price,oldprice){
                return price>oldprice?"red":"green";
            },
            stockIcon:function(price,oldprice){
                return price>oldprice?["glyphicon","glyphicon-chevron-up"]:["glyphicon","glyphicon-chevron-down"];
            },
            stockRange:function(price,oldprice){
                var val=price-oldprice;
                val=val.toFixed(2);
                return price>oldprice?"+"+val:""+val;
            }
        }
    });


    setInterval(function () {
        jQuery.ajax({
            url: "http://hq.sinajs.cn/list=sz399001,sh000001,sz399006,sh000300",
            dataType: "script",
            cache: true
        }).done(function() {
            app.initdata();
        });

    }, 1000);*/
</script>
</#compress>